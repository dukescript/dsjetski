/**
 * Copyright (c) 2014, 2015, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojpopupcore"],function(a,f){(function(){a.Da("oj.ojMenu",f.oj.baseComponent,{defaultElement:"\x3cul\x3e",delay:300,role:"menu",widgetEventPrefix:"oj",options:{menuSelector:"ul",openOptions:{initialFocus:"menu",launcher:null,position:{my:"start top",at:"start bottom"}},submenuOpenOptions:{position:{my:"start top",at:"end top"}},beforeOpen:null,select:null},_ComponentCreate:function(){this._super();this._focusForTesting=this.Kf;this._nextForTesting=
this.hU;this._selectForTesting=this.Lj;this.hp=this.element;this.JK=!1;this.element.uniqueId().addClass("oj-menu oj-component").hide().attr({role:this.role,tabIndex:"0"});this._on(!0,{"mousedown .oj-menu-item":function(a){this.options.disabled&&a.preventDefault()},click:function(a){this.options.disabled&&a.preventDefault()},keydown:function(a){!this.options.disabled||a.keyCode!==f.ui.keyCode.ESCAPE&&a.keyCode!==f.ui.keyCode.TAB||(a.keyCode===f.ui.keyCode.TAB&&a.preventDefault(),this.jc&&this.Ry(a))}});
this.options.disabled&&this.element.addClass("oj-disabled").attr("aria-disabled","true");var a=function(a){var b=f(a.currentTarget);b.siblings().children(".oj-focus-ancestor").removeClass("oj-focus-ancestor");this.Kf(a,b)}.bind(this);this._on({"mousedown .oj-menu-item \x3e a":function(a){a.preventDefault()},"click .oj-disabled \x3e a":function(a){a.preventDefault()},click:function(){this.JK=!1},touchstart:function(){this.P_=!1},"click .oj-menu-item:has(a)":function(a){var b=f(a.target).closest(".oj-menu-item");
!this.JK&&b.not(".oj-disabled").length&&(this.JK=!0,a.preventDefault(),this.ta&&this.ta.closest(b).length&&this.ta.get(0)!=b.get(0)||(b.has(".oj-menu").length?this.ce(a):(this.Lj(a),this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.ta&&1===this.ta.parents(".oj-menu").length&&clearTimeout(this.Sc)))))},"mouseenter .oj-menu-item":a,"touchstart .oj-menu-item":function(b){this.P_||(this.P_=!0,a(b))},mouseleave:function(a){this.yj(a,"eventSubtree")},"mouseleave .oj-menu":function(a){this.yj(a,
"eventSubtree")},focus:function(a,b){if(!b){var c=this.ta||this.element.children(".oj-menu-item").eq(0);this.Kf(a,c)}},keydown:this.No,keyup:function(a){if(a.keyCode==f.ui.keyCode.ENTER||a.keyCode==f.ui.keyCode.SPACE)this.Wx=!1}});this.Sv=f.proxy(this.Tv,this);this.za()},vq:function(a){if(arguments.length)b=a;else return b},DE:function(a){if(("focus"===a.type||"mousedown"===a.type||"touchstart"===a.type||93==a.which||121==a.which&&a.shiftKey||93==a.keyCode)&&("mousedown"!==a.type||!b)){var e=d.slice(0,
d.length);f.each(e,function(b,d){!f(a.target).closest(d.element).length&&("keydown"===a.type||"mousedown"===a.type&&3===a.which||!f(a.target).closest(d.jc).length||d.Baa&&("mousedown"===a.type&&3!==a.which||"touchstart"===a.type))&&(d.yj(a,"eventSubtree"),d.jc&&d.co(a))})}},_setOption:function(b,d){this._superApply(arguments);this.jc||("submenuOpenOptions"===b?this.HA=a.jd.Kg(d.position,this.rf):"submenuOpenOptions.position"===b&&(this.HA=a.jd.Kg(d,this.rf)))},_destroy:function(){this.element.is(":visible")&&
this.co();clearTimeout(this.Sc);delete this.Sc;this.element.removeAttr("aria-activedescendant").removeClass("oj-component oj-menu-icons").find(".oj-menu").addBack().removeClass("oj-menu").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".oj-menu-item").removeClass("oj-menu-item").removeAttr("role").children("a").removeAttr("aria-disabled").removeUniqueId().removeClass("oj-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var a=
f(this);a.data("oj-ojMenu-submenu-icon")&&a.remove()});this.element.find("a").removeAttr("aria-expanded");this.element.find(".oj-menu-divider").removeClass("oj-menu-divider").removeAttr("role");0<=d.indexOf(this)&&d.splice(d.indexOf(this),1);delete this.Ni;delete this.Sv;var a=this.Tt;isNaN(a)||(delete this.Tt,window.clearTimeout(a));this._super()},No:function(a){function b(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$\x26")}var d,h,k,l,m=!0;switch(a.keyCode){case f.ui.keyCode.HOME:this.Zz("first",
"first",a);break;case f.ui.keyCode.END:this.Zz("last","last",a);break;case f.ui.keyCode.UP:this.Lba(a);break;case f.ui.keyCode.DOWN:this.hU(a);break;case f.ui.keyCode.LEFT:case f.ui.keyCode.RIGHT:a.keyCode===f.ui.keyCode.RIGHT^this.rf?this.ta&&!this.ta.is(".oj-disabled")&&this.ce(a):this.yj(a,"active");break;case f.ui.keyCode.ENTER:case f.ui.keyCode.SPACE:this.v9(a);this.Wx=!0;var n=this;setTimeout(function(){n.Wx=!1},100);break;case f.ui.keyCode.TAB:a.preventDefault();this.jc&&this.Ry(a);break;case f.ui.keyCode.ESCAPE:this.jc?
(h=this.element.attr("aria-activedescendant"),k="#"+this.element.attr("id")+"\x3e*\x3ea",h&&!f("#"+h).is(k)?this.yj(a,"active"):this.Ry(a)):this.yj(a,"active");break;default:m=!1,d=this.SB||"",h=String.fromCharCode(a.keyCode),k=!1,clearTimeout(this.Nfa),h===d?k=!0:h=d+h,l=new RegExp("^"+b(h),"i"),d=this.hp.children(".oj-menu-item").filter(function(){return l.test(f(this).children("a").text())}),d=k&&-1!==d.index(this.ta.next())?this.ta.nextAll(".oj-menu-item"):d,d.length||(h=String.fromCharCode(a.keyCode),
l=new RegExp("^"+b(h),"i"),d=this.hp.children(".oj-menu-item").filter(function(){return l.test(f(this).children("a").text())})),d.length?(this.Kf(a,d),1<d.length?(this.SB=h,this.Nfa=this._delay(function(){delete this.SB},1E3)):delete this.SB):delete this.SB}m&&a.preventDefault()},v9:function(a){this.ta&&!this.ta.is(".oj-disabled")&&(this.ta.children("a[aria-haspopup\x3d'true']").length?this.ce(a):this.Lj(a))},refresh:function(){this._super();this.za();var a=this.element;if(a.is(":visible")){var b=
a.data("oj-menu-position");b&&a.position(b);a.find(".oj-menu").each(function(){var a=f(this);a.is(":visible")&&(b=a.data("oj-menu-position"))&&a.position(b)})}},za:function(){this.rf="rtl"===this.hc();this.HA=a.jd.Kg(this.options.submenuOpenOptions.position,this.rf);var b=this,d=this.element.find(this.options.menuSelector);this.element.toggleClass("oj-menu-icons",!!this.element.find(".oj-menu-item-icon").length);d.filter(":not(.oj-menu)").addClass("oj-menu").hide().attr({role:this.role,"aria-hidden":"true"}).each(function(){var a=
f(this),d=b.lG(a),e=f("\x3cspan\x3e");e.addClass("oj-menu-submenu-icon oj-component-icon").data("oj-ojMenu-submenu-icon",!0);d.attr("aria-haspopup","true").attr("aria-expanded","false").prepend(e);d=d.attr("id");a.attr("aria-labelledby",d)});d=d.add(this.element).children();d.filter(".oj-menu-divider").has("a").removeClass("oj-menu-divider oj-menu-item").removeAttr("role");d.filter(":not(.oj-menu-item):has(a)").addClass("oj-menu-item").attr("role","presentation").children("a").uniqueId().attr({tabIndex:"-1",
role:"menuitem"});d.filter(":not(.oj-menu-item)").each(function(){var a=f(this);/[^\-\u2014\u2013\s]/.test(a.text())||a.addClass("oj-menu-divider").attr("role","separator")});d.filter(".oj-disabled").children("a").attr("aria-disabled","true");d.filter(":not(.oj-disabled)").children("a").removeAttr("aria-disabled");this.ta&&!f.contains(this.element[0],this.ta[0])&&this.aE()},lG:function(a){return a.prev("a")},Aia:function(){return"menuitem"},Kf:function(a,b){a&&"focus"===a.type||clearTimeout(this.Sc);
b=b.first();this.UT(b,a);b.parent().closest(".oj-menu-item").children("a:first").addClass("oj-focus-ancestor");a&&"keydown"===a.type?this.Bk():this.Sc=this._delay(function(){delete this.Sc;this.Bk()},this.delay);var d=b.children(".oj-menu");d.length&&a&&/^mouse/.test(a.type)&&!this.ta.hasClass("oj-disabled")&&this.Uda(d);this.hp=b.parent()},UT:function(a,b){if(!a.is(this.ta)){var d=this.ta?this.ta:f(),h=a.children("a");this.ta=a;this.element.attr("aria-activedescendant",h.attr("id"));d.children("a").removeClass("oj-focus");
h.addClass("oj-focus");this._trigger("_activeItem",b,{previousItem:d,item:a,privateNotice:"The _activeItem event is private.  Do not use."})}},pca:function(a){if(this.ta){var b=this.ta;this.ta=null;this.element.removeAttr("aria-activedescendant");b.children("a").removeClass("oj-focus");this._trigger("_activeItem",a,{previousItem:b,item:f(),privateNotice:"The _activeItem event is private.  Do not use."})}},aE:function(a){clearTimeout(this.Sc);this.pca(a)},Ry:function(a){this.jc.focus();this.co(a)},
co:function(b){var e={};e[a.T.bb.Cf]=this.element;a.T.le().close(e);this.element.removeData("oj-menu-position");this.jc=void 0;this._trigger("__dismiss",b,{});0<=d.indexOf(this)&&d.splice(d.indexOf(this),1)},mba:function(a){f.each(["pageX","pageY"],function(b,d){if(a&&void 0===a[d]&&a.originalEvent){var f=a.originalEvent,k=f.type;(k="touchstart"===k||"touchmove"===k?"touches":"touchend"===k?"changedTouches":null)&&(f=f[k][0])&&(a[d]=f[d])}})},open:function(b,e,g){this.element.is(":visible")&&this.co();
e=f.extend({},this.options.openOptions,e);e.position=f.extend({},e.position);g=f.extend({},this.options.submenuOpenOptions,g);this.mba(b);this.Baa=this.Vx;if(this._trigger("beforeOpen",b,{openOptions:e})){var h=e.launcher;if((h="string"===f.type(h)?f(h):h)&&h.length){var k=a.jd.Kg(e.position,this.rf);k.of=a.jd.Uga(k.of,h,b);if(null==k.of)a.u.warn("position.of passed to Menu.open() is 'event', but the event is null.  Ignoring the call.");else{var l=this.element[0],m=d.slice(0,d.length);f.each(m,function(a,
d){d.element[0]!==l&&(d.yj(b,"eventSubtree"),d.jc&&d.co(b))});this.HA=a.jd.Kg(g.position,this.rf);g=this.Sv;f.isFunction(k.using)&&k.using!==g&&(k.origUsing=k.using);k.using=g;g={};g[a.T.bb.Cf]=this.element;g[a.T.bb.Rs]=h;g[a.T.bb.Vs]=k;g[a.T.bb.Kn]=this.$q();g[a.T.bb.Pl]="oj-menu-layer";a.T.le().open(g);this.element.data("oj-menu-position",k);e=e.initialFocus;((k="firstItem"===e)||"menu"===e)&&this.element.focus();k?this.Kf(b,this.element.children().first()):this.aE(b);this.jc=h;d.push(this)}}else a.u.warn("When calling Menu.open(), must specify openOptions.launcher via the component option, method param, or beforeOpen listener.  Ignoring the call.")}},
Uda:function(a){clearTimeout(this.Sc);"true"===a.attr("aria-hidden")&&(this.Sc&&clearTimeout(this.Sc),this.Sc=this._delay(function(){delete this.Sc;this.Bk();this.oU(a)},this.delay))},oU:function(a){var b=f.extend({of:this.ta},this.HA);clearTimeout(this.Sc);this.element.find(".oj-menu").not(a.parents(".oj-menu")).hide().attr("aria-hidden","true").removeData("oj-menu-position");a.show().removeAttr("aria-hidden").position(b).data("oj-menu-position",b);this.lG(a).attr("aria-expanded","true");!this.jc&&
0>d.indexOf(this)&&d.push(this)},ND:function(a,b,d){function h(){delete k.Sc;var d=b?k.element:f(a&&a.target).closest(k.element.find(".oj-menu"));d.length||(d=k.element);k.Bk(d);k.aE(a);k.hp=d}clearTimeout(this.Sc);var k=this;d?this.Sc=this._delay(h,d):h()},Bk:function(a){a||(a=this.ta?this.ta.parent():this.element);var b=a.find(".oj-menu");b.hide().attr("aria-hidden","true").removeData("oj-menu-position");this.lG(b).attr("aria-expanded","false");a.find("a.oj-focus-ancestor").removeClass("oj-focus-ancestor");
this.jc||0<=d.indexOf(this)&&a===this.element&&d.splice(d.indexOf(this),1)},yj:function(b,d){if(null==d||"active"===d){var f=this.hp&&this.hp.closest(".oj-menu-item",this.element);f&&f.length&&(this.Bk(),this.Kf(b,f))}else"all"===d||"eventSubtree"===d?this.ND(b,"all"===d,this.delay):a.u.warn("Invalid param "+d+" passed to Menu._collapse().  Ignoring the call.")},ce:function(a){var b=this.ta&&this.ta.children(".oj-menu ").children(".oj-menu-item").first();b&&b.length&&(this.oU(b.parent()),this.Sc&&
clearTimeout(this.Sc),this.Sc=this._delay(function(){delete this.Sc;this.Kf(a,b)}))},hU:function(a){this.Zz("next","first",a)},Lba:function(a){this.Zz("prev","last",a)},xia:function(){return this.ta&&!this.ta.prevAll(".oj-menu-item").length},yia:function(){return this.ta&&!this.ta.nextAll(".oj-menu-item").length},Zz:function(a,b,d){var f;this.ta&&(f="first"===a||"last"===a?this.ta["first"===a?"prevAll":"nextAll"](".oj-menu-item").eq(-1):this.ta[a+"All"](".oj-menu-item").eq(0));f&&f.length&&this.ta||
(f=this.hp.children(".oj-menu-item")[b]());this.Kf(d,f)},Lj:function(b){if(!this.ta&&b&&b.target){var d=f(b.target).closest(".oj-menu-item");d.closest(this.element).length&&this.UT(d,b)}this.ta?this.ta.has(".oj-menu").length||this.ta.is(".oj-disabled")?a.u.warn("Selecting a disabled menu item or parent menu item is not allowed."):(d={item:this.ta},this.ND(b,!0),this.jc&&this.Ry(b),this._trigger("select",b,d)):a.u.warn("Menu._select() called when no menu item is focused and no menu item can be inferred from event param.")},
ep:function(){this.element.remove()},$q:function(){if(!this.Ni){var b=this.Ni={};b[a.T.sc.Tp]=f.proxy(this.i5,this);b[a.T.sc.Up]=f.proxy(this.ep,this);b[a.T.sc.Rl]=f.proxy(this.refresh,this);b[a.T.sc.Sp]=f.proxy(this.DE,this)}return this.Ni},i5:function(){this.Bk(this.element);this.co(null)},Tv:function(a,b){var d=b.element.element;d.css(a);(d=d.data("oj-menu-position"))&&(d=d.origUsing)&&d(a,b)}});var d=[],b=!1})()});