/**
 * Copyright (c) 2014, 2015, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","ojs/ojpopupcore"],function(a,f){(function(){var d="oj-left oj-center oj-right oj-top oj-middle oj-bottom".split(" "),b={"right-top":"oj-right oj-top","right-middle":"oj-right oj-middle","right-bottom":"oj-right oj-bottom","left-top":"oj-left oj-top","left-middle":"oj-left oj-middle","left-bottom":"oj-left oj-bottom","center-top":"oj-center oj-top","center-middle":"oj-center oj-bottom","center-bottom":"oj-center oj-bottom"};a.Da("oj.ojPopup",f.oj.baseComponent,
{widgetEventPrefix:"oj",options:{autoDismiss:"focusLoss",chrome:"default",initialFocus:"none",position:{my:"start top",at:"start bottom",of:"",collision:"flip"},tail:"none",beforeOpen:null,open:null,beforeClose:null,close:null,focus:null},_ComponentCreate:function(){this._super();var a=f("\x3cdiv\x3e");this.Me=a.hide().addClass("oj-popup").attr("aria-hidden","true");a.addClass("oj-component");var b=f("\x3cdiv\x3e").addClass("oj-popup-content");b.attr("role","presentation");b.appendTo(a);this.element.after(a);
this.element.appendTo(b);this.element.show();this.MP();this.NV();this.Sv=f.proxy(this.Tv,this)},_destroy:function(){this.isOpen()&&this.Dq();this.iQ();delete this.Sv;delete this.Ni;a.C.unwrap(this.element,this.Me);this.element.hide();var b=this.Tt;isNaN(b)||(delete this.Tt,window.clearTimeout(b));this.jQ();this._super()},widget:function(){return this.Me},open:function(b,d){if(this.isOpen()&&(this.close(),this.isOpen()))return;this.uda(b);var f=this.Me;b=this.jc;a.j.Wa(f,jQuery);a.j.Wa(b,jQuery);a.Ba.Zh(f.attr("id"))&&
f.attr("id",this.sz("wrapper"));if(!1!==this._trigger("beforeOpen")){this.ZV(d);var h=this.options;this.iI(h.autoDismiss);this.M3();f.attr("role","tooltip");d=h.position;var k="rtl"===this.hc();d=a.jd.Kg(d,k);k="oj-popup-layer";h=h.tail;"none"!==h&&(k+=" "+["oj-popup-tail",h].join("-"));h={};h[a.T.bb.Cf]=f;h[a.T.bb.Rs]=b;h[a.T.bb.Vs]=d;h[a.T.bb.Kn]=this.$q();h[a.T.bb.Pl]=k;a.T.le().open(h);this._trigger("open");this.dH();this.R$();this._on(f,{keydown:this.qr,keyup:this.qr});b&&0<b.length&&this._on(b,
{keydown:this.qr,keyup:this.qr})}},close:function(){if(this.isOpen()&&(!1!==this._trigger("beforeClose")||this.Mu)){this.Vca();var b=this.jc,d=this.Me;a.j.Wa(d,jQuery);a.j.Wa(b,jQuery);this._off(d,"keydown keyup");b&&0<b.length&&this._off(b,"keydown keyup");this.jQ();b={};b[a.T.bb.Cf]=d;a.T.le().close(b);this.uca();this.iI();delete this.jc;d=this.options.position;d._ofo&&(delete d._ofo,delete d.of);this._trigger("close")}},isOpen:function(){return this.Me.is(":visible")},refresh:function(){this._super();
this.isOpen()&&this.qV();var b=this.Me;a.j.Wa(b,jQuery);a.T.le().oL(b,a.T.sc.Rl)},_setOption:function(a,b){var d=this.options;switch(a){case "tail":b!==d.tail&&this.Bda(b);break;case "chrome":b!==d.chrome&&this.NV(b);break;case "position":this.ZV(b);this.refresh();return;case "autoDismiss":this.isOpen()&&b!==d.autoDismiss&&this.iI(b)}this._superApply(arguments)},qia:function(){return"oj-popup"},Bda:function(a){this.iQ();this.MP(a);this.qV()},MP:function(b){b=b?b:this.options.tail;if("none"!==b){b=
["oj-popup-tail",b].join("-");var d=f("\x3cdiv\x3e").hide();d.addClass("oj-popup-tail").addClass(b);d.attr("role","presentation");this.LW="#"+d.attr("id",this.sz("tail")).attr("id");var g=this.Me;a.j.Wa(g,jQuery);d.appendTo(g);g.addClass(b);this.isOpen()&&(d={},d[a.T.bb.Cf]=g,d[a.T.bb.Pl]="oj-popup-layer "+b,a.T.le().$v(d))}},iS:function(){var a=this.LW;return a?f(a):null},iQ:function(){var b=this.iS();b&&b.remove();delete this.LW;var d=["oj-popup-tail",this.options.tail].join("-"),b=this.Me;a.j.Wa(b,
jQuery);b.removeClass(d);this.isOpen()&&(d={},d[a.T.bb.Cf]=b,d[a.T.bb.Pl]="oj-popup-layer",a.T.le().$v(d))},NV:function(b){b=b?b:this.options.chrome;var d=this.Me;a.j.Wa(d,jQuery);"default"===b&&d.hasClass("oj-popup-no-chrome")?d.removeClass("oj-popup-no-chrome"):"none"!==b||d.hasClass("oj-popup-no-chrome")||d.addClass("oj-popup-no-chrome")},uda:function(b){b?"string"===f.type(b)?b=f(b):1===b.nodeType&&(b=f(b)):b=f(document.activeElement);if(b instanceof jQuery&&1<b.length){var d=this.Me;a.j.Wa(d,
jQuery);for(var g=0;g<b.length;g++){var h=b[0];if(!a.C.nn(d[0],h)){b=f(h);break}}}else if(!(b instanceof jQuery)||b instanceof jQuery&&0===b.length)b=f(document.activeElement);a.j.Wa(b,jQuery);this.jc=b},ZV:function(b){var d=this.options;b&&(d.position=f.extend(d[b],b));b=d.position;d=this.Sv;a.j.hl(d);f.isFunction(b.using)&&b.using!==d&&(b.origUsing=b.using);b.using=d;d=this.jc;a.j.Wa(d,jQuery);b.of||(b.of=d,b._ofo=!0)},Tv:function(c,e){var f=e.element.element;a.j.Wa(f,jQuery);var h=this.iS();if(h){h.hide();
for(var k=0;k<d.length;k++)h.removeClass(d[k]),f.removeClass(d[k]);h.removeAttr("style");if(e.target&&0===e.target.height&&0===e.target.width&&(k="rtl"===this.hc(),k=a.jd.Kg(this.options.position,k).my,!a.Ba.Zh(k))){var k=k.split(" "),l=k[0],m="middle";1<k.length&&(m="center"===k[1]?"middle":k[1]);e.horizontal=l;e.vertical=m}k=b[[e.horizontal,e.vertical].join("-")];a.j.il(k);h.addClass(k);f.addClass(k);h.show();"left"===e.horizontal||"right"===e.horizontal?(k=(h.outerWidth()-1)*("left"===e.horizontal?
1:-1),c.left+=k):"center"===e.horizontal&&(k=(h.outerHeight()-1)*("top"===e.vertical?1:-1),c.top+=k);f.css(c);"center"===e.horizontal?(f=f.width(),f=Math.round((f/2-h.outerWidth()/2)/f*100),h.css({left:f+"%"})):"middle"===e.vertical&&(f=f.height(),f=Math.round((f/2-h.outerHeight()/2)/f*100),h.css({top:f+"%"}))}else f.css(c);(h=this.options.position.origUsing)&&h(c,e)},qV:function(){var b=this.Me;a.j.Wa(b,jQuery);var d=this.options.position;a.j.ie(d);var f="rtl"===this.hc();b.position(a.jd.Kg(d,f))},
dH:function(b){var d=this.options;if(b||"none"!==d.initialFocus)if(b||"firstFocusable"===d.initialFocus)b=this.element.find(":focusable"),0<b.length?(b=b[0],a.j.Cg(b),f(b).focus()):(b=this.Me,a.j.Wa(b,jQuery),b.attr("tabindex","-1"),b.focus()),this._trigger("focus")},Kz:function(b,d){b||(b=document.activeElement);a.j.Cg(b);if(!b)return!1;var f=this.Me;a.j.Wa(f,jQuery);d&&(f=f.parent());return a.C.nn(f[0],b)},qT:function(b){b||(b=document.activeElement);a.j.Cg(b);var d=this.jc;a.j.Wa(d,jQuery);return a.C.nn(d[0],
b)},Vca:function(){if(this.TS)delete this.TS;else if(this.Kz(null,!0)){var b=this.jc;a.j.Wa(b,jQuery);b.focus()}},qr:function(b){if(!b.isDefaultPrevented()){var d=b.type,g=b.target;a.j.Cg(g);if("keyup"===d&&b.keyCode===f.ui.keyCode.ESCAPE&&(this.Kz(g)||this.qT(g)))b.preventDefault(),this.close();else if("keydown"===d&&117===b.keyCode)this.Kz(g)?(b.preventDefault(),b=this.jc,a.j.Wa(b,jQuery),b.focus()):this.qT(g)&&(b.preventDefault(),this.dH(!0));else if("keydown"===d&&b.keyCode===f.ui.keyCode.TAB&&
this.Kz(g)){var h=this.element.find(":tabbable");0<h.length?(d=h[0],a.j.Cg(d),h=h[h.length-1],a.j.Cg(h),d===g&&b.shiftKey?(b.preventDefault(),f(h).focus()):h!==g||b.shiftKey||(b.preventDefault(),f(d).focus())):(b.preventDefault(),b=this.jc,a.j.Wa(b,jQuery),b.focus())}}},iI:function(b){var d=this.TQ,g=this.$q();d&&(delete g[a.T.sc.Sp],delete this.TQ);"focusLoss"===b&&(d=this.TQ=f.proxy(this.y6,this),g[a.T.sc.Sp]=d);this.isOpen()&&(b=this.Me,a.j.Wa(b,jQuery),d={},d[a.T.bb.Cf]=b,d[a.T.bb.Kn]=g,a.T.le().$v(d))},
y6:function(b){var d=this.jc,g=this.Me;a.j.Wa(d,jQuery);a.j.Wa(g,jQuery);var g=g.parent(),h=b.target;a.j.Cg(h);var k=this.Sy;if(k&&(k=k.getLink())&&a.C.nn(k[0],h))return;if(!a.C.nn(d[0],h)&&!a.C.nn(g[0],h)){if(f(h).is(":focusable")){if("mousedown"===b.type||"touchstart"===b.type)return;this.TS=!0}this.close()}},M3:function(){var b=this.jc,d=this.Me;a.j.Wa(b,jQuery);a.j.Wa(d,jQuery);var d=d.attr("id"),g=b.attr("aria-describedby"),g=g?g.split(/\s+/):[];g.push(d);g=f.trim(g.join(" "));b.attr("aria-describedby",
g)},uca:function(){var b=this.jc,d=this.Me;a.j.Wa(b,jQuery);a.j.Wa(d,jQuery);var d=d.attr("id"),g=b.attr("aria-describedby"),g=g?g.split(/\s+/):[],d=f.inArray(d,g);-1!==d&&g.splice(d,1);(g=f.trim(g.join(" ")))?b.attr("aria-describedby",g):b.removeAttr("aria-describedby")},R$:function(){var b=a.Qa.fw().os===a.Qa.ni.GC,d=this.lH;d||(d=this.lH=new a.$d);var g;g=b?this.D("none"===this.options.initialFocus?"ariaLiveRegionInitialFocusNoneTouch":"ariaLiveRegionInitialFocusFirstFocusableTouch"):this.D("none"===
this.options.initialFocus?"ariaLiveRegionInitialFocusNone":"ariaLiveRegionInitialFocusFirstFocusable");d.Xea(g);if(b){if(!this.Sy){var d=this.sz("focusSkipLink"),h=this.jc,b=f.proxy(this.dH,this,!0);g=this.D("ariaFocusSkipLink");this.Sy=new a.Gh(h,g,b,d)}this.FE||(d=this.sz("closeSkipLink"),h=this.element,b=f.proxy(this.Dq,this),g=this.D("ariaCloseSkipLink"),this.FE=new a.Gh(h,g,b,d))}},jQ:function(){var a=this.lH;a&&(a.destroy(),delete this.lH);if(a=this.Sy)a.destroy(),delete this.Sy;if(a=this.FE)a.destroy(),
delete this.FE},sz:function(b){var d=this.element.attr("id");a.Ba.Zh(d)&&(d=this.uuid);return[d,b].join("_")},ep:function(){this.element.remove()},$q:function(){if(!this.Ni){var b=this.Ni={};b[a.T.sc.Tp]=f.proxy(this.Dq,this);b[a.T.sc.Up]=f.proxy(this.ep,this);b[a.T.sc.Rl]=f.proxy(this.refresh,this)}return this.Ni},Dq:function(){this.Mu=!0;this.close();delete this.Mu}})})()});