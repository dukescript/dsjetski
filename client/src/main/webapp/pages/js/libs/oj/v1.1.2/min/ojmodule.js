/**
 * Copyright (c) 2014, 2015, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(["ojs/ojcore","knockout","promise"],function(a,f){a.Rp={};a.Rp.ac={viewPath:"text!views/",viewSuffix:".html",modelPath:"viewModels/",initializeMethod:"initialize",disposeMethod:"dispose",activatedHandler:"handleActivated",attachedHandler:"handleAttached",detachedHandler:"handleDetached",bindingsAppliedHandler:"handleBindingsApplied",deactivatedHandler:"handleDeactivated"};o_("ModuleBinding.defaults",a.Rp.ac,a);(function(){function d(a,b,c){if(a&&a[b]){var d={element:c[0],valueAccessor:c[1]};
2<c.length&&(d.viewModel=c[2],3<c.length&&(d["boolean"===typeof c[3]?"fromCache":"cachedNodes"]=c[3]));return f.ignoreDependencies(a[b],a,[d])}}function b(b,c,d){if(null!=b&&(c=a.Rp.ac[c],null!=c&&b&&(c=b[c],"function"===typeof c))){var e=void 0;d&&(e={element:d[0],valueAccessor:d[1]},2<d.length&&(e["boolean"===typeof d[2]?"fromCache":"cachedNodes"]=d[2]));return f.ignoreDependencies(c,b,[e])}}function c(a,b,c,d){for(var e=a.firstChild;e;){var g=e.nextSibling;e!==c&&(d&&f.cleanNode(e),b?(b.push(e),
c.appendChild(e)):a.removeChild(e));e=g}}function e(b,c){if(null!=a.Components)for(var d=0;d<b.length;d++)c?a.Components.Il(b[d]):a.Components.En(b[d])}function g(a){return a="string"===typeof a?f.utils.parseHtmlFragment(a):(window.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType)?f.utils.arrayPushAll([],a.childNodes):f.utils.arrayPushAll([],a)}function h(a){return new Promise(function(b){require([a],function(a){b(a)},function(){throw Error("ojModule failed to load "+a);})})}f.bindingHandlers.ojModule=
{init:function(k,l,m,n,q){function p(a){if(a!=x)throw Error("Promise cancelled because ojModule is fetching new View and ViewModel");}function r(a){b(a,"disposeMethod",[k,l])}var s,t={},v,x=-1,u;f.utils.domNodeDisposal.addDisposeCallback(k,function(){r(s);for(var a=Object.keys(t),b=0;b<a.length;b++)r(t[a[b]].un)});f.computed(function(){x++;var m=f.utils.unwrapObservable(l()),n,B,y,E,C,H,D;"string"===typeof m?n=m:(n=f.utils.unwrapObservable(m.name),B=f.utils.unwrapObservable(m.viewName),y=f.utils.unwrapObservable(m.params),
E=f.utils.unwrapObservable(m.viewModelFactory),C=f.utils.unwrapObservable(m.createViewFunction),H=f.utils.unwrapObservable(m.cacheKey),D=f.utils.unwrapObservable(m.lifecycleListener));var m=d(D,"activated",[k,l]),A,G,F=null==H?null:t[H];if(null!=F)delete t[H],A=Promise.resolve(F.view),G=Promise.resolve(F.un);else if(null!=E&&(G=f.ignoreDependencies(E.createViewModel,E,[y,l])),null==G&&null!=n&&(G=h(a.Rp.ac.modelPath+n)),null!=G&&(G=G.then(function(a,c){p(a);return c="function"===typeof c?new c(y):
b(c,"initializeMethod",[k,l])||c}.bind(null,x)),null!=C&&(A=G.then(function(a,b){p(a);var c=null==b?null:b[C];return null==c?null:c()}.bind(null,x)))),null==A)if(B=null==B?n:B,null!=B)A=h(a.Rp.ac.viewPath+B+a.Rp.ac.viewSuffix);else throw Error("View name must be specified");if(null==A)throw Error("ojModule is missing a View");var J;null!=G&&(J=G.then(function(a,c){p(a);return b(c,"activatedHandler",[k,l])}.bind(null,x)));Promise.all([A,G,m,J]).then(function(a,h){if(a==x){var p=g(h[0]),m=h[1],n=!1,
w;null!=v&&(n=!0,w=[],u||(u=document.createElement("div"),u.className="oj-helper-module-cache",k.appendChild(u)));c(k,w,u,!n);0<x&&(d(D,"detached",[k,l,s,w]),b(s,"detachedHandler",[k,l,w]),d(D,"deactivated",[k,l,s]),b(s,"deactivatedHandler",[k,l]));n?(e(w,!1),t[v]={un:s,view:w}):r(s);s=m;v=H;n=0;for(w=p.length;n<w;n++)u?k.insertBefore(p[n],u):k.appendChild(p[n]);(n=null!=F)&&e(p,!0);d(D,"attached",[k,l,s,n]);b(s,"attachedHandler",[k,l,n]);if(!n){n=q.createChildContext(m,void 0,function(a){a.$module=
m});w=0;for(var z=p.length;w<z;w++){var B=p[w],y=B.nodeType;1!=y&&8!=y||f.applyBindings(n,B)}d(D,"bindingsApplied",[k,l,m]);b(m,"bindingsAppliedHandler",[k,l])}}}.bind(null,x),function(b,c){b==x&&a.u.error(c)}.bind(null,x))},null,{Nia:k});return{controlsDescendantBindings:!0}}}})()});