/**
 * Copyright (c) 2014, 2015, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatacollection-common","ojs/ojmodel"],function(a){a.ud=function(f,d,b,c,e){a.j.pc(f,null);a.j.pc(d,null);a.j.pc(b,null);a.j.pc(c,null);a.j.Yv(e);this.ci=f;this.xp=d;this.ck=b;this.wp=c;this.Fd=e};o_("CollectionCellSet",a.ud,a);a.ud.prototype.w_=function(f){a.j.fB(f);null!=f&&f.length===this.R("row")&&(this.Ap=f)};a.ud.prototype.getData=function(a){var d;d=this.Ib(a);return null==d?null:d.get(this.Fd[a.column])};a.b.i("CollectionCellSet.prototype.getData",{getData:a.ud.prototype.getData});
a.ud.prototype.getMetadata=function(f){var d;d=this.Ib(f);return null==d?null:{keys:{row:a.Jn.Yq(d),column:this.Fd[f.column]}}};a.b.i("CollectionCellSet.prototype.getMetadata",{getMetadata:a.ud.prototype.getMetadata});a.ud.prototype.Ib=function(f){var d;if(null==this.Ap)return null;a.j.ie(f);d=f.row;f=f.column;a.j.assert(d>=this.ci&&d<=this.xp&&f>=this.ck&&f<=this.wp);return this.Ap[d-this.ci]};a.ud.prototype.R=function(a){return"row"===a?Math.max(0,this.xp-this.ci):"column"===a?Math.max(0,this.wp-
this.ck):0};a.b.i("CollectionCellSet.prototype.getCount",{R:a.ud.prototype.R});a.ud.prototype.getStartRow=function(){return this.ci};a.b.i("CollectionCellSet.prototype.getStartRow",{getStartRow:a.ud.prototype.getStartRow});a.ud.prototype.uY=function(){return this.xp};a.b.i("CollectionCellSet.prototype.getEndRow",{uY:a.ud.prototype.uY});a.ud.prototype.getStartColumn=function(){return this.ck};a.b.i("CollectionCellSet.prototype.getStartColumn",{getStartColumn:a.ud.prototype.getStartColumn});a.ud.prototype.tY=
function(){return this.wp};a.b.i("CollectionCellSet.prototype.getEndColumn",{tY:a.ud.prototype.tY});a.ud.prototype.jn=function(){return this.Fd};a.b.i("CollectionCellSet.prototype.getColumns",{jn:a.ud.prototype.jn});a.ya=function(f,d){this.Ea=f;null!=d&&(this.Qw=d.rowHeader,this.columns=d.columns);a.ya.q.constructor.call(this)};o_("CollectionDataGridDataSource",a.ya,a);a.b.ga(a.ya,a.fc,"oj.CollectionDataGridDataSource");a.ya.prototype.Init=function(){a.ya.q.Init.call(this);this.Cl={};this.VH()};a.b.i("CollectionDataGridDataSource.prototype.Init",
{Init:a.ya.prototype.Init});a.ya.prototype.VH=function(){this.Ea.on("add",this.M9.bind(this));this.Ea.on("remove",this.O9.bind(this));this.Ea.on("change",this.N9.bind(this));this.Ea.on("refresh",this.f9.bind(this));this.Ea.on("reset",this.g9.bind(this))};a.ya.prototype.faa=function(){return null!=this.data};a.ya.prototype.R=function(a){var d;void 0==this.precision&&(this.precision={});if("row"==a){d=this.Qd();if(-1===d||0===d&&(!this.faa()||0<this.Qi()))return this.precision[a]="estimate",-1;this.precision[a]=
"exact";return this.Qi()}if("column"==a){if(null!=this.columns)return this.precision[a]="exact",this.columns.length;this.precision[a]="estimate";return-1}return 0};a.b.i("CollectionDataGridDataSource.prototype.getCount",{R:a.ya.prototype.R});a.ya.prototype.Sf=function(a){null!=this.precision&&null!=this.precision[a]||this.R(a);return this.precision[a]};a.b.i("CollectionDataGridDataSource.prototype.getCountPrecision",{Sf:a.ya.prototype.Sf});a.ya.prototype.Sd=function(a,d,b){var c,e;null!=d&&(c=a.axis,
e={},e.cZ=a,e.callbacks=d,e.Zv=b,this.Cl[c]=e)};a.b.i("CollectionDataGridDataSource.prototype.fetchHeaders",{Sd:a.ya.prototype.Sd});a.ya.prototype.A9=function(f,d,b,c){var e,g,h,k;e=f.axis;g=f.start;h=f.count;a.j.assert("row"===e||"column"===e);a.j.assert(0<h);if("column"===e)null!=this.columns?(c=Math.min(this.columns.length,g+h),k=new a.Hc(g,c,this.columns)):k=new a.td(g,g,e,null);else if("row"===e){if(null!=this.Qw){null!=c&&(h=c.count);c=Math.min(this.Qi(),g+h);k=new a.Hc(g,c,this.columns,this.Qw);
this.yV(g,c,k,f,d,b);return}k=new a.td(g,g,e,null)}null!=d&&d.success&&d.success.call(b.success,k,f)};a.ya.prototype.UR=function(f){var d,b,c,e,g,h;for(d=0;d<f.length;d+=1)b=f[d],a.j.assert("row"===b.axis||"column"===b.axis),a.j.assert(0<b.count),"row"===b.axis?(c=b.start,e=b.count):"column"===b.axis&&(g=b.start,h=b.count);return{rowStart:c,rowCount:e,colStart:g,colCount:h}};a.ya.prototype.Y8=function(f,d,b,c){var e,g,h;e=this.UR(f);g=e.rowStart;c=null!=c?Math.min(this.Qi(),g+c.count):Math.min(this.Qi(),
g+e.rowCount);h=e.colStart;e=Math.min(null==this.columns?0:this.columns.length,h+e.colCount);e=new a.ud(g,c,h,e,this.columns);this.yV(g,c,e,f,d,b)};a.ya.prototype.yV=function(a,d,b,c,e,g){var h;for(h=[];a<d;a++)h.push(this.Ea.at(a,{deferred:!0}));Promise.all(h).then(function(a){b.w_(a);e.success.call(g.success,b,c)})};a.ya.prototype.ke=function(a,d,b){null!=d&&(this.$f={},this.$f.CX=a,this.$f.callbacks=d,this.$f.Zv=b);this.a7(a)};a.b.i("CollectionDataGridDataSource.prototype.fetchCells",{ke:a.ya.prototype.ke});
a.ya.prototype.DU=function(a){var d,b,c,e,g;d=this.Cl[a];null!=d&&(b=d.cZ,c=d.callbacks,e=d.Zv,"row"===a&&(g=d.iJ),this.A9(b,c,e,g),this.Cl[a]=null)};a.ya.prototype.Qba=function(){this.Y8(this.$f.CX,this.$f.callbacks,this.$f.Zv,this.$f.iJ)};a.ya.prototype.a7=function(a){var d;a=this.UR(a);d=a.rowStart;this.Ea.Rw(d,a.rowCount).then(function(a){this.data=!0;var c=this.Ea.at(d,{deferred:!0});this.eda(a.start,a.count);null!=c&&void 0===this.columns?c.then(function(a){this.qI(a);this.HQ()}.bind(this)):
this.HQ()}.bind(this),function(a){this.b7(a)}.bind(this))};a.ya.prototype.b7=function(f){a.u.error(f);null!=this.Cl&&(this.EU("column",f),this.EU("row",f));null!=this.$f&&this.Rba(f)};a.ya.prototype.EU=function(a,d){var b,c,e;b=this.Cl[a];null!=b&&(c=b.callbacks,e=b.Zv,b=b.cZ,c.error&&c.error.call(e.error,d,b),this.Cl[a]=null)};a.ya.prototype.Rba=function(a){var d,b,c;d=this.$f.callbacks;b=this.$f.Zv;c=this.$f.CX;d.error&&d.error.call(b.error,a,c);this.$f=null};a.ya.prototype.HQ=function(){null!=
this.Cl&&(this.DU("column"),this.DU("row"));null!=this.$f&&this.Qba()};a.ya.prototype.eda=function(a,d){var b={start:a,count:d};null!=this.Cl.row&&(this.Cl.row.iJ=b);null!=this.$f&&(this.$f.iJ=b)};a.ya.prototype.qI=function(a){this.columns=a.keys();-1!=this.columns.indexOf(this.Qw)&&this.columns.splice(this.columns.indexOf(this.Qw),1)};a.ya.prototype.keys=function(f){var d,b,c,e,g,h;d=f.row;b=f.column;h=this;return new Promise(function(f){g=h.Ea.at(d,{deferred:!0});null!=g?g.then(function(d){c=a.Jn.Yq(d);
null==h.columns&&h.qI(d);e=h.columns[b];f({row:null==c?null:c,column:null==e?null:e})}.bind(h)):f({row:null,column:null})})};a.b.i("CollectionDataGridDataSource.prototype.keys",{keys:a.ya.prototype.keys});a.ya.prototype.oe=function(a){var d,b,c,e;d=a.row;b=a.column;e=this;return new Promise(function(a){e.Ea.indexOf(d,{deferred:!0}).then(function(d){null==e.columns?e.Ea.first(1,{deferred:!0}).then(function(f){e.qI(f);c=e.columns.indexOf(b);a({row:d,column:c})}.bind(e)):(c=e.columns.indexOf(b),a({row:d,
column:c}))}.bind(e))})};a.b.i("CollectionDataGridDataSource.prototype.indexes",{oe:a.ya.prototype.oe});a.ya.prototype.getCapability=function(a){return"sort"===a?"column":"move"===a?"row":null};a.b.i("CollectionDataGridDataSource.prototype.getCapability",{getCapability:a.ya.prototype.getCapability});a.ya.prototype.sort=function(a,d,b){var c,e,g;null==b&&(b={});null==a?this.dI(d,b):(e=a.direction,g=a.key,a=a.axis,"column"===a?(this.Ea.ab()?(this.Ea.comparator=g,this.Ea.sortDirection="ascending"===
e?1:-1):("ascending"===e&&(c=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString(),c=!0);b instanceof Date&&(b=b.toISOString(),d=!0);return c&&d?a<b?-1:a===b?0:1:c?1:d?-1:a-b}),"descending"===e&&(c=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString());b instanceof Date&&(b=b.toISOString());return c&&d?a>b?-1:a===b?0:1:c?-1:d?1:b-a}),this.Ea.comparator=c),this.Ea.sort(),null!=d&&null!=d.success&&d.success.call(b.success)):
null!=d&&null!=d.error&&d.error.call(b.error,"Axis value not supported"))};a.b.i("CollectionDataGridDataSource.prototype.sort",{sort:a.ya.prototype.sort});a.ya.prototype.dI=function(a,d){this.Ea.comparator=null;this.Ea.reset();null!=a&&null!=a.success&&a.success.call(d.success)};a.ya.prototype.move=function(a,d,b,c,e){var g;this.Ea.get(a,{deferred:!0}).then(function(b){null==d?(this.Ea.remove(b),this.Ea.add(b),null!=c&&null!=c.success&&c.success.call(e.success)):(a===d?(g=this.Ea.indexOf(d,{deferred:!0}),
this.Ea.remove(b)):(this.Ea.remove(b),g=this.Ea.indexOf(d,{deferred:!0})),g.then(function(a){this.Ea.add(b,{at:a,Sia:!0});null!=c&&null!=c.success&&c.success.call(e.success)}.bind(this)))}.bind(this))};a.b.i("CollectionDataGridDataSource.prototype.move",{move:a.ya.prototype.move});a.ya.prototype.Dj=function(a,d,b,c,e){var g={source:this};g.operation=a;g.keys={row:d,column:b};g.indexes={row:c,column:e};return g};a.ya.prototype.M9=function(f){var d,b;this.Ea.indexOf(f,{deferred:!0}).then(function(c){b=
a.Jn.Yq(f);d=this.Dj("insert",b,null,c,-1);this.handleEvent("change",d)}.bind(this))};a.ya.prototype.O9=function(f,d,b){this.handleEvent("change",this.Dj("delete",a.Jn.Yq(f),null,b.index,-1))};a.ya.prototype.N9=function(f){var d,b;this.Ea.indexOf(f,{deferred:!0}).then(function(c){b=a.Jn.Yq(f);d=this.Dj("update",b,null,c,-1);this.handleEvent("change",d)}.bind(this))};a.ya.prototype.f9=function(){this.data=null;this.handleEvent("change",this.Dj("refresh",null,null))};a.ya.prototype.g9=function(){this.data=
null;this.handleEvent("change",this.Dj("reset",null,null))};a.ya.prototype.Qi=function(){return this.Ea.size()};a.ya.prototype.Qd=function(){return void 0===this.Ea.totalResults?-1:this.Ea.totalResults};a.ya.prototype.nY=function(){return this.Ea};a.b.i("CollectionDataGridDataSource.prototype.getCollection",{nY:a.ya.prototype.nY});a.ya.prototype.jn=function(){return this.columns};a.b.i("CollectionDataGridDataSource.prototype.getColumns",{jn:a.ya.prototype.jn});a.ya.prototype.kw=function(){return this.Qw};
a.b.i("CollectionDataGridDataSource.prototype.getRowHeader",{kw:a.ya.prototype.kw});a.ya.prototype.getData=function(){return this.data};a.b.i("CollectionDataGridDataSource.prototype.getData",{getData:a.ya.prototype.getData});a.Jn=function(){};a.Jn.Yq=function(a){var d;d=a.Bf();null==d&&(d=a.Nn());return d};a.Hc=function(f,d,b,c){a.j.pc(f,null);a.j.pc(d,null);a.j.Yv(b);this.ec=f;this.Ud=d;this.JB=b;this.Zf=c};o_("CollectionHeaderSet",a.Hc,a);a.Hc.prototype.w_=function(f){a.j.fB(f);null!=f&&f.length===
this.R()&&(this.Ap=f)};a.Hc.prototype.getData=function(f,d){var b;a.j.assert(f<=this.Ud&&f>=this.ec,"index out of bounds");a.j.assert(null==d||0==d,"level out of bounds");if(null!=this.Zf){if(null==this.Ap)return null;b=this.Ap[f-this.ec];return b.get(this.Zf)}return this.JB[f]};a.b.i("CollectionHeaderSet.prototype.getData",{getData:a.Hc.prototype.getData});a.Hc.prototype.getMetadata=function(f,d){var b;a.j.assert(f<=this.Ud&&f>=this.ec,"index out of bounds");a.j.assert(null==d||0==d,"level out of bounds");
if(null!=this.Zf){if(null==this.Ap)return null;b=this.Ap[f-this.ec];return{key:a.Jn.Yq(b)}}return{key:this.getData(f,d)}};a.b.i("CollectionHeaderSet.prototype.getMetadata",{getMetadata:a.Hc.prototype.getMetadata});a.Hc.prototype.Vf=function(){return 0<this.R()?1:0};a.b.i("CollectionHeaderSet.prototype.getLevelCount",{Vf:a.Hc.prototype.Vf});a.Hc.prototype.Rb=function(f,d){a.j.assert(f<=this.Ud&&f>=this.ec,"index out of bounds");a.j.assert(null==d||0==d,"level out of bounds");return{extent:1,more:{before:!1,
after:!1}}};a.b.i("CollectionHeaderSet.prototype.getExtent",{Rb:a.Hc.prototype.Rb});a.Hc.prototype.Td=function(f,d){a.j.assert(f<=this.Ud&&f>=this.ec,"index out of bounds");a.j.assert(null==d||0==d,"level out of bounds");return 1};a.b.i("CollectionHeaderSet.prototype.getDepth",{Td:a.Hc.prototype.Td});a.Hc.prototype.R=function(){return Math.max(0,this.Ud-this.ec)};a.b.i("CollectionHeaderSet.prototype.getCount",{R:a.Hc.prototype.R});a.Hc.prototype.ua=function(){return this.ec};a.b.i("CollectionHeaderSet.prototype.getStart",
{ua:a.Hc.prototype.ua});a.Hc.prototype.sY=function(){return this.Ud};a.b.i("CollectionHeaderSet.prototype.getEnd",{sY:a.Hc.prototype.sY});a.Hc.prototype.AY=function(){return this.JB};a.b.i("CollectionHeaderSet.prototype.getHeaders",{AY:a.Hc.prototype.AY});a.Hc.prototype.kw=function(){return this.Zf};a.b.i("CollectionHeaderSet.prototype.getRowHeader",{kw:a.Hc.prototype.kw})});