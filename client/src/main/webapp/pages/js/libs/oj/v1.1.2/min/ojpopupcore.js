/**
 * Copyright (c) 2014, 2015, Oracle and/or its affiliates.
 * All rights reserved.
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","jqueryui-amd/position"],function(a,f){a.T=function(){this.Init()};a.b.ga(a.T,a.b,"oj.PopupService");a.T.prototype.Init=function(){a.T.q.Init.call(this)};a.T.le=function(){a.T.GH||(a.T.GH=new a.rb);return a.T.GH};a.T.prototype.open=function(){a.j.Ya()};a.T.prototype.close=function(){a.j.Ya()};a.T.prototype.$v=function(){a.j.Ya()};a.T.prototype.oL=function(){a.j.Ya()};a.T.prototype.destroy=function(){delete a.T.GH};a.T.mi={NONE:"none",IC:"modal",
K0:"modeless"};a.T.sc={Up:"ojPopupRemove",Tp:"ojPopupClose",Rl:"ojPopupRefresh",Sp:"ojPopupAutoDismiss"};a.T.bb={Cf:"popup",Kn:"events",mi:"modality",Rs:"launcher",Vs:"position",Pl:"layerSelectors"};a.rb=function(){this.Init()};a.b.ga(a.rb,a.T,"oj.PopupServiceImpl");a.rb.prototype.open=function(d){a.j.ie(d);var b=d[a.T.bb.Cf];a.j.Wa(b,jQuery);var c=d[a.T.bb.Rs];a.j.Wa(c,jQuery);var e=d[a.T.bb.Vs];a.j.lJ(e);var f=d[a.T.bb.Kn];a.j.ie(f);var h=d[a.T.bb.mi];a.j.gB(h);if(!h||a.T.mi.K0!==h&&a.T.mi.IC!==
h)h=a.T.mi.NONE;d=d[a.T.bb.Pl];a.j.il(d);a.C.v_(b,c);a.N.Uea(b,c,f,h,d);b.show();b.removeAttr("aria-hidden");e&&b.position(e);this.VD();a.Components.Il(b[0])};a.rb.prototype.close=function(d){a.j.ie(d);d=d[a.T.bb.Cf];a.j.Wa(d,jQuery);a.N.jha(d);d.hide();d.attr("aria-hidden","true");a.C.v_(d,null);this.VD();a.Components.En(d[0])};a.rb.prototype.$v=function(d){a.j.ie(d);var b=d[a.T.bb.Cf];a.j.Wa(b,jQuery);b=a.N.hw(b);a.j.Wa(b,jQuery);var c=d[a.T.bb.Kn];a.j.lJ(c);c&&a.N.sX(b,c);(c=d[a.T.bb.mi])&&a.N.tX(b,
c);d=d[a.T.bb.Pl];a.Ba.Zh(d)||b.attr("class",d)};a.rb.prototype.oL=function(d,b,c){var e={};e.event=b;e.argsArray=c;d=a.N.hw(d);a.N.QK(d,this.sea,e)};a.rb.prototype.sea=function(d,b){var c=b.event,e=b.argsArray,g=a.N.OJ(d);g&&f.isFunction(g[c])&&g[c].apply(this,e);return a.N.lg.In};a.rb.prototype.VD=function(){var d=a.N.bZ(),b=this.ZO;if(!d&&b){window.removeEventListener("resize",a.rb.Pm,!0);window.removeEventListener("scroll",a.rb.Pm,!0);d=document.documentElement;d.removeEventListener("mousewheel",
a.rb.Pm,!0);d.removeEventListener("DOMMouseScroll",a.rb.Pm,!0);delete this.ZO;for(var c=0;c<a.rb.Jx.length;c++){var e=a.rb.Jx[c];d.removeEventListener(e,b,!0)}if(b=this.sW)b.destroy(),delete this.sW}else if(d&&!b){window.addEventListener("resize",a.rb.Pm,!0);window.addEventListener("scroll",a.rb.Pm,!0);d=document.documentElement;d.addEventListener("mousewheel",a.rb.Pm,!0);d.addEventListener("DOMMouseScroll",a.rb.Pm,!0);b=this.ZO=f.proxy(this.T6,this);for(c=0;c<a.rb.Jx.length;c++)e=a.rb.Jx[c],d.addEventListener(e,
b,!0);a.C.sf()&&(this.sW=new a.qi(b))}};a.rb.prototype.T6=function(d){var b=f(d.target);if(!a.N.bZ())this.VD();else if(!a.C.lZ(d)&&("focus"!==d.type||b.is(":focusable"))){var c=a.N.kn();if("keydown"===d.type&&a.N.rga()&&!a.C.$j(c[0],b[0]))a.N.XX(f.Event(d));else{var e=a.N.hw(b);if(c[0]!==e[0]){if(!e.hasClass(a.rb.rx)){var g=this.kH;g&&g.removeClass(a.rb.rx);e.addClass(a.rb.rx);this.kH=e}}else if(g=this.kH)g.removeClass(a.rb.rx),delete this.kH;if("focus"!==d.type||"-1"!==b.attr("tabindex")){var b=
{},e={},h;for(h in d)f.isFunction(d[h])||(e[h]=d[h]);b.event=f.Event(d,e);a.N.QK(c,a.rb.cca,b)}}}};a.rb.cca=function(d,b){var c=a.N.OJ(d),e=b.event;if(c&&f.isFunction(c[a.T.sc.Sp]))c[a.T.sc.Sp](e);return a.N.lg.In};a.rb.Pm=function(){isNaN(a.rb.XU)&&(a.rb.XU=window.setTimeout(function(){delete a.rb.XU;var d=a.N.kn();a.N.QK(d,a.rb.gca)},a.rb.W2))};a.rb.gca=function(d,b){if(0<b.level)return a.N.lg.dx;var c=a.N.OJ(d);if(c&&f.isFunction(c[a.T.sc.Rl]))c[a.T.sc.Rl]();return a.N.lg.In};a.rb.prototype.destroy=
function(){a.rb.q.destroy.call(this)};a.rb.rx="oj-focus-within";a.rb.Jx=["focus","mousedown","keydown"];a.rb.W2=100;a.N={};a.N.hw=function(d){if(!d)return a.N.kn();for(;d&&0<d.length&&d.attr("oj.ZOrderUtils._SURROGATE_ATTR")!==a.N.dD;){if(a.N.SG(d[0]))return d;d=d.parent()}return a.N.kn()};a.N.kn=function(){var d=f("#"+a.N.dD);if(0<d.length)return d;d=f("\x3cdiv\x3e");d.attr("role","presentation");d.attr("id",a.N.dD);d.prependTo(f(document.body));return d};a.N.Uea=function(d,b,c,e,g){var h=d[0];if(a.N.SG(h.parentNode))throw Error("JET Popup is already open - id: "+
h.getAttribute("id"));b=a.N.hw(e!==a.T.mi.NONE?null:b);var k=f("\x3cdiv\x3e"),l=d.attr("id");a.Ba.Zh(l)?k.uniqueId():k.attr("id",[l,"layer"].join("_"));k.attr("role","presentation");k.addClass(g);d.after(k);g=a.N.e6(k);a.Components.bg(h);d.appendTo(k);k.appendTo(b);a.Components.vf(h);a.N.tX(k,e);a.N.sX(k,c,g)};a.N.sX=function(d,b,c){if(!c){var e=d.attr(a.N.wt);e&&(c=f("#"+e))}d.data(a.N.qx,b);c&&b&&f.isFunction(b[a.T.sc.Up])&&(c.surrogate(),c.surrogate("option","beforeDestroy",b[a.T.sc.Up]))};a.N.OJ=
function(d){return d.data(a.N.qx)};a.N.e6=function(d){var b=f("\x3cscript\x3e"),c=d.attr("id");a.Ba.Zh(c)?b.uniqueId():b.attr("id",[c,"surrogate"].join("_"));b.insertBefore(d);c=b.attr("id");d.attr(a.N.wt,c);return b};a.N.Dca=function(d){var b=d.attr(a.N.wt);d.removeAttr(a.N.wt);b=f("#"+b);d.insertAfter(b);b.surrogate("option","beforeDestroy",null);b.remove()};a.N.jha=function(d){var b=a.N.hw(d);a.N.RK(b,a.N.j5);a.N.$H(b);b.removeData(a.N.qx);b.removeData(a.N.lD);var c=d[0];a.Components.bg(c);a.N.Dca(b);
a.C.unwrap(d,b);a.Components.vf(c)};a.N.j5=function(d,b){if(0<b.level)return a.N.lg.dx;var c=d.data(a.N.qx);if(c&&f.isFunction(c[a.T.sc.Tp]))c[a.T.sc.Tp]();return a.N.lg.In};a.N.tX=function(d,b){var c=d.data(a.N.lD);d.data(a.N.lD,b);a.Ba.Zh(c)?a.T.mi.IC===b?a.N.oO(d):a.N.$H(d):c!==b&&(b!==c&&b===a.T.mi.IC?a.N.oO(d):a.N.$H(d))};a.N.rga=function(){for(var d=a.N.kn().children(),b=d.length-1;-1<b;b--)if(f(d[b]).hasClass(a.N.xN))return!0;return!1};a.N.oO=function(d){var b=f("\x3cdiv\x3e");b.addClass(a.N.xN);
b.attr("role","presentation");var c=d.attr("id");a.Ba.Zh(c)?b.uniqueId():b.attr("id",[c,"overlay"].join("_"));d.before(b);b.on("keydown keyup keypress mousedown mouseup mouseover mouseout click focusin focus",a.N.XX);b=b.attr("id");d.attr(a.N.oD,b)};a.N.$H=function(d){var b=d.attr(a.N.oD);a.Ba.Zh(b)||(d.removeAttr(a.N.oD),f("#"+b).remove())};a.N.lg={In:0,dx:1,oC:2};a.N.Tx={YL:0,WL:1};a.N.QK=function(d,b,c){c||(c={});c.level=0;c.type=a.N.Tx.WL;a.N.hJ(d,b,c)};a.N.RK=function(d,b,c){c||(c={});c.level=
0;c.type=a.N.Tx.YL;a.N.hJ(d,b,c)};a.N.hJ=function(d,b,c){var e=c.level;d=d.children();for(var g=d.length-1;-1<g;g--){var h=f(d[g]);if(a.N.SG(h[0])){var k;if(c.type===a.N.Tx.YL){k=b(h,c);if(k===a.N.lg.oC)return k;if(k===a.N.lg.dx)break}c.level=e+1;k=a.N.hJ(h,b,c);c.level=e;if(k===a.N.lg.oC)return k;if(c.type===a.N.Tx.WL){k=b(h,c);if(k===a.N.lg.oC)return k;if(k===a.N.lg.dx)break}}}return a.N.lg.In};a.N.SG=function(d){return 1===d.nodeType&&d.hasAttribute(a.N.wt)?!0:!1};a.N.bZ=function(){return 0<a.N.kn().children().length};
a.N.VJ=function(){var d={popupCount:0},b=a.N.kn();a.N.RK(b,a.N.pba,d);return d.popupCount};a.N.pba=function(d,b){b.popupCount+=1;return a.N.lg.In};a.N.GJ=function(){var d={},b=[];d.popups=b;b=a.N.kn();a.N.RK(b,a.N.qba,d);b=d.popups;return f(b)};a.N.qba=function(d,b){b.popups.push(d[0]);return a.N.lg.In};a.N.wJ=function(d,b){function c(b,c){for(var d=["absolute","relative","fixed"],e=b.parents(),g=[],h=e.length-1;-1<h;h--)g.push(f(e[h]));e=g;e.push(b);for(var g=[],k=0,h=0;h<e.length;h++){var l=e[h],
m=l.css("position"),n=a.C.Ufa(l.css("opacity")),B=a.C.Vfa(l.css("z-index")),l=f.inArray(l[0],l.parent().children());-1<f.inArray(m,d)?g.push({weight:[k++,B,l],order:[l]}):1>n?g.push({weight:[k++,1,l],order:[l]}):c&&g.push({weight:[0,0,l],order:[l]})}return g}function e(a,b){for(var c=Math.max(a.length,b.length),d=0;d<c;d++){var e=d<a.length?a[d]:-1,f=d<b.length?b[d]:-1;if(e!==f)return e<f?-1:1}return 0}a.j.Wa(d,jQuery);a.j.Wa(b,jQuery);for(var g=c(d,!1),h=c(b,!1),k=Math.max(g.length,h.length),l=0;l<
k;l++){var m=l<g.length?g[l].weight:[-1],n=l<h.length?h[l].weight:[-1],m=e(m,n);if(0!==m)return m}g=c(d,!0);h=c(b,!0);k=Math.max(g.length,h.length);for(l=0;l<k;l++)if(m=l<g.length?g[l].order:[-1],n=l<h.length?h[l].order:[-1],m=e(m,n),0!==m)return m;return 0};a.N.XX=function(a){a.stopPropagation();a.preventDefault()};a.N.qx="oj-popup-events";a.N.lD="oj-popup-modality";a.N.dD="__oj_zorder_container";a.N.wt="data-oj-surrogate-id";a.N.oD="data-oj-overlayid";a.N.xN="oj-component-overlay";f.widget("oj.surrogate",
{options:{create:null,beforeDestroy:null},_create:function(){this._super();this.element.uniqueId()},_destroy:function(){this._trigger("beforeDestroy");this.element.removeUniqueId();this._super()}});a.qi=function(a){this.MW=a;this.Init()};a.b.ga(a.qi,a.b,"oj.SimpleTapRecognizer");a.qi.prototype.Init=function(){a.qi.q.Init.call(this);for(var d=this.BQ=f.proxy(this.Ky,this),b=document.documentElement,c=0;c<a.qi.Qx.length;c++)b.addEventListener(a.qi.Qx[c],d,!0)};a.qi.prototype.Ky=function(a){var b=this.MW,
c=a.type;"touchstart"===c?this.PA=a:"touchmove"===c||"touchcancel"===c?delete this.PA:"touchend"===c&&(this.PA&&b(this.PA),delete this.PA)};a.qi.prototype.destroy=function(){delete this.MW;var d=this.BQ;delete this.BQ;for(var b=document.documentElement,c=0;c<a.qi.Qx.length;c++)b.removeEventListener(a.qi.Qx[c],d,!0)};a.qi.Qx=["touchstart","touchmove","touchcancel","touchend"];a.$d=function(){this.Init()};a.b.ga(a.$d,a.b,"oj.PopupLiveRegion");a.$d.prototype.Init=function(){a.$d.q.Init.call(this);isNaN(a.$d.qv)?
a.$d.qv=1:++a.$d.qv};a.$d.prototype.destroy=function(){if(!isNaN(a.$d.qv)&&(--a.$d.qv,1>a.$d.qv)){var d=f("#"+a.$d.sD);0<d.length&&d.remove()}};a.$d.prototype.Xea=function(d){if(!a.Ba.Ig(d)){var b=a.$d.n8();b.children().remove();f("\x3cdiv\x3e").text(d).appendTo(b)}};a.$d.n8=function(){var d=f("#"+a.$d.sD);0===d.length&&(d=f("\x3cdiv\x3e"),d.attr({id:a.$d.sD,role:"log","aria-live":"polite","aria-relevant":"additions"}),d.addClass("oj-helper-hidden-accessible"),d.appendTo(document.body));return d};
a.$d.sD="__oj_popup_arialiveregion";a.Gh=function(d,b,c,e){a.j.Wa(d,jQuery);a.j.il(b);a.j.hl(c);a.j.gB(e);this.DA=d;this.vr=b;this.sE=c;this.QS=e?e:"";this.Init()};a.b.ga(a.Gh,a.b,"oj.PopupSkipLink");a.Gh.prototype.Init=function(){a.Gh.q.Init.call(this);var d=this.DA,b=this.sE,c=this.vr;delete this.vr;var e=this.QS;delete this.QS;var g=f("\x3ca\x3e").attr({tabindex:"-1",href:"#"});a.Ba.Ig(e)||g.attr("id",e);g.addClass("oj-helper-hidden-accessible");g.text(c);g.insertAfter(d);g.on("click",b);d.data(a.Gh.Nx,
g)};a.Gh.prototype.destroy=function(){var d=this.DA;delete this.DA;var b=this.sE;delete this.sE;if(d){var c=d.data(a.Gh.Nx);d.removeData(a.Gh.Nx);c&&(c.off("click",b),c.remove())}};a.Gh.prototype.getLink=function(){var d=this.DA,b;d&&(b=d.data(a.Gh.Nx));return b};a.Gh.Nx="oj-skiplink";a.jd={};a.jd.Kg=function(d,b){a.j.ie(d,"position");for(var c=f.extend({},d),e=0;e<a.jd.tM.length;e++){var g=a.jd.tM[e],h=c[g];h&&(c[g]=h.replace("start",b?"right":"left").replace("end",b?"left":"right").replace("\x3c",
b?"+":"-").replace("\x3e",b?"-":"+"))}return c};a.jd.Uga=function(a,b,c){return"event"===a?c:null==a||"launcher"===a?b:a};a.jd.tM=["my","at"];a.jd.Yia=function(){return!1};f.ui.position.flipcenter={left:function(d,b){var c=d.left;f.ui.position.flip.left.call(this,d,b);var e=b.within,g=e.isWindow?e.scrollLeft:e.offset.left,h=d.left-b.collisionPosition.marginLeft,e=h+b.collisionWidth-e.width-g;if(0<g-h||0<e)"right"===b.at[0]?c-=b.targetWidth/2:"left"===b.at[0]&&(c+=b.targetWidth/2),g="rtl"===a.C.rs()?
-1:1,c-=b.elemWidth/2*g,d.left=c},top:function(a,b){var c=a.top;f.ui.position.flip.top.call(this,a,b);var e=b.within,e=e.isWindow?e.scrollTop:e.offset.top,g=a.top-b.collisionPosition.marginTop,h=g+b.collisionHeight-b.within.height-e;if(0<e-g||0<h)"top"===b.at[1]?c+=b.targetHeight/2:"bottom"===b.at[1]&&(c-=b.targetHeight/2),c+=b.elemHeight/2,a.top=c}}});